---
// Challenge 5: Real vs Fake Image Detection
// User must identify the real image from a pair, 5 correct in a row to win
---

<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>üñºÔ∏è Challenge 5: Real oder Fake?</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        font-family: 'Comic Sans MS', 'Comic Neue', cursive;
      }

      .challenge-page {
        min-height: 100vh;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        padding: 20px;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .back-btn {
        position: fixed;
        left: 20px;
        top: 20px;
        color: #ffd700;
        text-decoration: none;
        font-size: 1rem;
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        transition: all 0.3s;
        cursor: pointer;
        z-index: 100;
      }

      .back-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .challenge-header {
        text-align: center;
        margin-top: 40px;
        margin-bottom: 20px;
      }

      h1 {
        font-size: 2.5rem;
        color: #e91e63;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        margin-bottom: 10px;
      }

      h2 {
        font-size: 1.5rem;
        color: #fff;
        margin-bottom: 10px;
      }

      .instructions {
        color: #aaa;
        font-size: 1rem;
        max-width: 500px;
        line-height: 1.5;
      }

      /* Progress indicator */
      .progress {
        margin: 20px 0;
        text-align: center;
      }

      .progress-text {
        font-size: 1.5rem;
        color: #ffd700;
        margin-bottom: 10px;
      }

      .progress-dots {
        display: flex;
        gap: 10px;
        justify-content: center;
      }

      .dot {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        transition: all 0.3s;
      }

      .dot.filled {
        background: #4CAF50;
        border-color: #4CAF50;
        box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
      }

      /* Images container */
      .images-container {
        display: flex;
        gap: 20px;
        justify-content: center;
        align-items: center;
        margin: 30px 0;
        flex-wrap: wrap;
      }

      .image-card {
        position: relative;
        cursor: pointer;
        transition: all 0.3s;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      }

      .image-card:hover {
        transform: scale(1.03);
        box-shadow: 0 15px 40px rgba(0,0,0,0.6);
      }

      .image-card img {
        width: 400px;
        height: 400px;
        object-fit: cover;
        display: block;
      }

      .image-card.correct {
        animation: correctFlash 0.5s ease-out;
        box-shadow: 0 0 30px rgba(76, 175, 80, 0.8);
      }

      .image-card.wrong {
        animation: wrongShake 0.5s ease-out;
        box-shadow: 0 0 30px rgba(244, 67, 54, 0.8);
      }

      @keyframes correctFlash {
        0%, 100% { border: 5px solid transparent; }
        50% { border: 5px solid #4CAF50; }
      }

      @keyframes wrongShake {
        0%, 100% { transform: translateX(0); border: 5px solid #f44336; }
        20% { transform: translateX(-15px); }
        40% { transform: translateX(15px); }
        60% { transform: translateX(-10px); }
        80% { transform: translateX(10px); }
      }

      .image-label {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0,0,0,0.7);
        color: white;
        text-align: center;
        padding: 10px;
        font-size: 1.2rem;
        font-weight: bold;
      }

      /* Feedback message */
      .feedback {
        font-size: 1.5rem;
        min-height: 50px;
        text-align: center;
        margin-top: 20px;
      }

      .feedback.correct {
        color: #4CAF50;
      }

      .feedback.wrong {
        color: #f44336;
      }

      /* Disabled state during transition */
      .images-container.disabled {
        pointer-events: none;
        opacity: 0.7;
      }

      /* Success Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal-content {
        background: linear-gradient(135deg, #1a4a1a, #0d2d0d);
        padding: 50px;
        border-radius: 20px;
        text-align: center;
        border: 3px solid #4CAF50;
        box-shadow: 0 0 50px rgba(76, 175, 80, 0.4);
        animation: modalPop 0.5s ease-out;
      }

      @keyframes modalPop {
        0% { transform: scale(0) rotate(-10deg); opacity: 0; }
        100% { transform: scale(1) rotate(0); opacity: 1; }
      }

      .modal-content h2 {
        font-size: 2.5rem;
        color: #4CAF50;
        margin-bottom: 20px;
      }

      .modal-content p {
        font-size: 1.3rem;
        margin-bottom: 10px;
      }

      .action-btn {
        margin-top: 25px;
        padding: 15px 40px;
        font-size: 1.3rem;
        font-family: inherit;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: bold;
        background: linear-gradient(135deg, #4CAF50, #2E7D32);
        color: white;
        box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
      }

      .action-btn:hover {
        transform: scale(1.05);
      }

      .play-on-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      .modal-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 25px;
      }

      .modal-buttons .action-btn {
        margin-top: 0;
      }

      /* Completed state */
      .completed-msg {
        margin-top: 50px;
        background: rgba(76, 175, 80, 0.2);
        padding: 30px 50px;
        border-radius: 15px;
        border: 2px solid #4CAF50;
        text-align: center;
      }

      .completed-msg h2 {
        color: #4CAF50;
        font-size: 2rem;
      }

      /* Responsive */
      @media (max-width: 900px) {
        .image-card img {
          width: 280px;
          height: 280px;
        }
      }

      @media (max-width: 700px) {
        body {
          font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif;
        }

        .image-card img {
          width: 200px;
          height: 200px;
        }

        h1 {
          font-size: 1.8rem;
        }

        .images-container {
          gap: 10px;
        }
      }

      @media (max-width: 500px) {
        .image-card img {
          width: 160px;
          height: 160px;
        }
      }
    </style>
  </head>
  <body>
    <div class="challenge-page">
      <a href="/landing" class="back-btn">‚Üê Zur√ºck</a>
      
      <header class="challenge-header">
        <h1>üñºÔ∏è Challenge 5</h1>
        <h2>Real oder Fake? Ihh dene Ziite wichtig!</h2>
        <p class="instructions">Klick uf s'echte Bild! Plzzz 5 richtig in Folg.</p>
      </header>

      <div class="progress">
        <div class="progress-text"><span id="streak">0</span> / 5</div>
        <div class="progress-dots">
          <div class="dot" data-dot="0"></div>
          <div class="dot" data-dot="1"></div>
          <div class="dot" data-dot="2"></div>
          <div class="dot" data-dot="3"></div>
          <div class="dot" data-dot="4"></div>
        </div>
      </div>

      <div class="images-container" id="images-container">
        <div class="image-card" id="left-card" data-side="left">
          <img id="left-img" src="" alt="Bild Links" />
        </div>
        <div class="image-card" id="right-card" data-side="right">
          <img id="right-img" src="" alt="Bild Rechts" />
        </div>
      </div>

      <div class="feedback" id="feedback"></div>

      <!-- Already completed message -->
      <div id="completed-msg" class="completed-msg" style="display: none;">
        <h2>‚úÖ Bereits geschafft!</h2>
        <p>Du hast diese Challenge schon bestanden.</p>
        <button id="play-on-btn" class="action-btn play-on-btn">üîÑ Lah mich wiiterspiele:((</button>
      </div>

      <!-- Success Modal -->
      <div id="success-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <h2>üéâ SHEEESH!</h2>
          <p>Bisch ja voll de kenner!</p>
          <p style="color: #aaa; font-style: italic;">CraazyMaazyAMKK</p>
          <div class="modal-buttons">
            <button id="continue-btn" class="action-btn">üö™ Zum Trip</button>
            <button id="play-on-modal-btn" class="action-btn play-on-btn">üîÑ Lah mich wiiterspiele:((</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Image pairs - note different extensions
      const IMAGE_PAIRS = [
        { real: '/images/fake-real/real1.JPG', fake: '/images/fake-real/fake1.jpg' },
        { real: '/images/fake-real/real2.JPG', fake: '/images/fake-real/fake2.jpg' },
        { real: '/images/fake-real/real3.JPG', fake: '/images/fake-real/fake3.jpg' },
        { real: '/images/fake-real/real4.JPG', fake: '/images/fake-real/fake4.jpeg' },
        { real: '/images/fake-real/real5.JPG', fake: '/images/fake-real/fake5.jpg' },
        { real: '/images/fake-real/real6.JPG', fake: '/images/fake-real/fake6.jpg' },
        { real: '/images/fake-real/real7.JPG', fake: '/images/fake-real/fake7.jpg' },
        { real: '/images/fake-real/real8.JPG', fake: '/images/fake-real/fake8.jpg' },
        { real: '/images/fake-real/real9.JPG', fake: '/images/fake-real/fake9.jpg' },
        { real: '/images/fake-real/real10.JPG', fake: '/images/fake-real/fake10.jpg' },
      ];

      const REQUIRED_STREAK = 5;

      const imagesContainer = document.getElementById('images-container') as HTMLElement;
      const leftCard = document.getElementById('left-card') as HTMLElement;
      const rightCard = document.getElementById('right-card') as HTMLElement;
      const leftImg = document.getElementById('left-img') as HTMLImageElement;
      const rightImg = document.getElementById('right-img') as HTMLImageElement;
      const streakEl = document.getElementById('streak') as HTMLElement;
      const feedbackEl = document.getElementById('feedback') as HTMLElement;
      const successModal = document.getElementById('success-modal') as HTMLElement;
      const continueBtn = document.getElementById('continue-btn') as HTMLButtonElement;
      const completedMsg = document.getElementById('completed-msg') as HTMLElement;
      const playOnBtn = document.getElementById('play-on-btn') as HTMLButtonElement;
      const playOnModalBtn = document.getElementById('play-on-modal-btn') as HTMLButtonElement;

      let currentStreak = 0;
      let currentPairIndex = -1;
      let realIsOnLeft = true;
      let isProcessing = false;

      // Check if already completed
      if (localStorage.getItem('challenge5_complete') === 'true') {
        imagesContainer.style.display = 'none';
        document.querySelector('.progress')?.setAttribute('style', 'display: none');
        completedMsg.style.display = 'block';
      } else {
        loadNextPair();
      }

      function updateDots() {
        for (let i = 0; i < REQUIRED_STREAK; i++) {
          const dot = document.querySelector(`.dot[data-dot="${i}"]`);
          if (dot) {
            if (i < currentStreak) {
              dot.classList.add('filled');
            } else {
              dot.classList.remove('filled');
            }
          }
        }
        streakEl.textContent = String(currentStreak);
      }

      function getRandomPairIndex() {
        // Get a random index different from the current one
        let newIndex;
        do {
          newIndex = Math.floor(Math.random() * IMAGE_PAIRS.length);
        } while (newIndex === currentPairIndex && IMAGE_PAIRS.length > 1);
        return newIndex;
      }

      function loadNextPair() {
        currentPairIndex = getRandomPairIndex();
        const pair = IMAGE_PAIRS[currentPairIndex];
        
        // Randomize which side the real image is on
        realIsOnLeft = Math.random() < 0.5;
        
        if (realIsOnLeft) {
          leftImg.src = pair.real;
          rightImg.src = pair.fake;
        } else {
          leftImg.src = pair.fake;
          rightImg.src = pair.real;
        }

        // Reset visual states
        leftCard.classList.remove('correct', 'wrong');
        rightCard.classList.remove('correct', 'wrong');
        feedbackEl.textContent = '';
        feedbackEl.className = 'feedback';
        imagesContainer.classList.remove('disabled');
      }

      function handleChoice(clickedLeft: boolean) {
        if (isProcessing) return;
        if (localStorage.getItem('challenge5_complete') === 'true') return;

        isProcessing = true;
        imagesContainer.classList.add('disabled');

        const isCorrect = (clickedLeft && realIsOnLeft) || (!clickedLeft && !realIsOnLeft);
        const clickedCard = clickedLeft ? leftCard : rightCard;
        const otherCard = clickedLeft ? rightCard : leftCard;

        if (isCorrect) {
          // Correct!
          currentStreak++;
          clickedCard.classList.add('correct');
          feedbackEl.textContent = '‚úÖ Richtig!';
          feedbackEl.className = 'feedback correct';
          updateDots();

          if (currentStreak >= REQUIRED_STREAK) {
            // WIN!
            setTimeout(() => {
              localStorage.setItem('challenge5_complete', 'true');
              successModal.style.display = 'flex';
            }, 800);
          } else {
            // Load next pair
            setTimeout(() => {
              isProcessing = false;
              loadNextPair();
            }, 1000);
          }
        } else {
          // Wrong!
          currentStreak = 0;
          clickedCard.classList.add('wrong');
          feedbackEl.textContent = '‚ùå Falsch! Wieder vo vorne...';
          feedbackEl.className = 'feedback wrong';
          updateDots();

          // Reset and load new pair
          setTimeout(() => {
            isProcessing = false;
            loadNextPair();
          }, 1500);
        }
      }

      // Click handlers
      leftCard.addEventListener('click', () => handleChoice(true));
      rightCard.addEventListener('click', () => handleChoice(false));

      // Continue button
      continueBtn.addEventListener('click', () => {
        window.location.href = '/trips/5';
      });

      // Play on function - fully reset the challenge
      function playOn() {
        // Remove completion from localStorage (door will be locked again)
        localStorage.removeItem('challenge5_complete');
        
        // Reset streak
        currentStreak = 0;
        updateDots();
        
        // Hide completed message and modal
        completedMsg.style.display = 'none';
        successModal.style.display = 'none';
        
        // Show game elements and remove disabled class
        imagesContainer.style.display = '';
        imagesContainer.classList.remove('disabled');
        document.querySelector('.progress')?.setAttribute('style', '');
        
        // Reset visual states on cards
        leftCard.classList.remove('correct', 'wrong');
        rightCard.classList.remove('correct', 'wrong');
        feedbackEl.textContent = '';
        feedbackEl.className = 'feedback';
        
        // Reset processing state
        isProcessing = false;
        
        // Load next pair
        loadNextPair();
      }

      // Play on buttons
      playOnBtn?.addEventListener('click', playOn);
      playOnModalBtn?.addEventListener('click', playOn);
    </script>
  </body>
</html>
