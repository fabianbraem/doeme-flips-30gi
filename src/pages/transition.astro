---
// Transition page with voice-over
---

<html lang="de-CH">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="description" content="D'Geburtstagssite fÃ¼r DÃ¶me & Flips - 30 Jahre alt!" />
    <title>ðŸŽ‚ HAPPY 30th BIRTHDAY - DÃ¶me & Flips</title>
  </head>
  <body>
    <div class="transition-page">
      
      <!-- Main Image (centered) -->
      <img 
        class="main-image" 
        src="/video/main-image.png" 
        alt="Main"
      />

      <!-- Audio -->
      <audio 
        id="transition-audio" 
        src="/audio/wiehnachtsmah-erklearung.mp3"
        preload="auto"
      ></audio>

      <!-- Flying videos container (will be populated by JS) -->
      <div id="flying-videos-container"></div>

      <!-- Button Container -->
      <div class="button-container">
        <button id="replay-btn" class="action-btn replay-btn">
          ðŸ”„
        </button>
        <button id="accept-btn" class="action-btn accept-btn">
          ICH WILL GSCHÃ„Ã„Ã„NK!!!
        </button>
      </div>

    </div>
  </body>
</html>

<style>
  /* Reset */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    min-height: 100vh;
    overflow: hidden;
    background: #000;
  }

  /* Transition Page */
  .transition-page {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  /* Main Image */
  .main-image {
    max-width: 70vw;
    max-height: 60vh;
    width: auto;
    height: auto;
    object-fit: contain;
    z-index: 10;
  }

  /* Flying videos container */
  #flying-videos-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 20;
    overflow: hidden;
  }

  /* Button Container */
  .button-container {
    position: fixed;
    bottom: 50px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    z-index: 600;
  }

  /* Action Buttons */
  .action-btn {
    padding: 20px 40px;
    font-size: 1.3rem;
    font-family: 'Comic Sans MS', 'Comic Neue', cursive;
    font-weight: bold;
    color: white;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Accept Button */
  .accept-btn {
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    box-shadow: 0 8px 30px rgba(238, 90, 36, 0.5);
    animation: buttonPulse 2s ease-in-out infinite;
  }

  .accept-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 40px rgba(238, 90, 36, 0.7);
  }

  /* Replay Button */
  .replay-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
    padding: 15px 20px;
    font-size: 1.8rem;
    min-width: auto;
  }

  .replay-btn:hover {
    transform: scale(1.2);
    box-shadow: 0 12px 40px rgba(102, 126, 234, 0.7);
  }

  @keyframes buttonPulse {
    0%, 100% { 
      box-shadow: 0 8px 30px rgba(238, 90, 36, 0.5);
    }
    50% { 
      box-shadow: 0 8px 50px rgba(238, 90, 36, 0.8);
    }
  }

  /* Responsive */
  @media (max-width: 600px) {
    .button-container {
      flex-direction: column;
      gap: 15px;
      bottom: 30px;
    }

    .action-btn {
      padding: 15px 30px;
      font-size: 1rem;
      font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif;
    }

    .main-image {
      max-width: 90vw;
      max-height: 50vh;
    }
  }
</style>

<!-- Global styles for flying videos -->
<style is:global>
  .flying-video {
    position: fixed;
    pointer-events: none;
    z-index: 20;
    animation: flyAround var(--duration) linear forwards;
  }

  @keyframes flyAround {
    0% {
      transform: translate(0, 0) rotate(0deg) scale(0.5);
      opacity: 0;
    }
    10% {
      opacity: 1;
      transform: translate(calc(var(--tx) * 0.1), calc(var(--ty) * 0.1)) rotate(calc(var(--rot) * 0.1)) scale(1);
    }
    90% {
      opacity: 1;
    }
    100% {
      transform: translate(var(--tx), var(--ty)) rotate(var(--rot)) scale(0.8);
      opacity: 0;
    }
  }
</style>

<script>
  const transitionAudio = document.getElementById('transition-audio') as HTMLAudioElement;
  const replayBtn = document.getElementById('replay-btn') as HTMLButtonElement;
  const acceptBtn = document.getElementById('accept-btn') as HTMLButtonElement;
  const flyingContainer = document.getElementById('flying-videos-container') as HTMLElement;

  let flyingInterval: number | null = null;

  // All available flying videos
  const flyingVideos = [
    '/video/weihnachtsmah-video.webm',
    '/video/HDSePvgcETtr02CysSglg_output.webm',
    '/video/jNbGaZ4fAejZKUcstOqZM_output.webm',
    '/video/jz-OalVjGiR5yvaXexMHe_output.webm'
  ];

  // Create a flying video element
  function createFlyingVideo() {
    const video = document.createElement('video');
    video.className = 'flying-video';
    video.src = flyingVideos[Math.floor(Math.random() * flyingVideos.length)];
    video.autoplay = true;
    video.loop = true;
    video.muted = true;
    video.playsInline = true;
    
    // Random size (100-200px)
    const size = 100 + Math.random() * 100;
    video.style.width = size + 'px';
    video.style.height = 'auto';
    
    // Random starting position (from any edge)
    const startEdge = Math.floor(Math.random() * 4);
    let startX: number, startY: number, endX: number, endY: number;
    
    const vw = window.innerWidth;
    const vh = window.innerHeight;
    
    switch (startEdge) {
      case 0: // Start from left
        startX = -size;
        startY = Math.random() * vh;
        endX = vw + size;
        endY = Math.random() * vh;
        break;
      case 1: // Start from right
        startX = vw + size;
        startY = Math.random() * vh;
        endX = -size;
        endY = Math.random() * vh;
        break;
      case 2: // Start from top
        startX = Math.random() * vw;
        startY = -size;
        endX = Math.random() * vw;
        endY = vh + size;
        break;
      default: // Start from bottom
        startX = Math.random() * vw;
        startY = vh + size;
        endX = Math.random() * vw;
        endY = -size;
        break;
    }
    
    const tx = endX - startX;
    const ty = endY - startY;
    const rot = (Math.random() - 0.5) * 720; // Random rotation
    const duration = 4 + Math.random() * 4; // 4-8 seconds
    
    video.style.left = startX + 'px';
    video.style.top = startY + 'px';
    video.style.setProperty('--tx', tx + 'px');
    video.style.setProperty('--ty', ty + 'px');
    video.style.setProperty('--rot', rot + 'deg');
    video.style.setProperty('--duration', duration + 's');
    
    flyingContainer.appendChild(video);
    
    // Start playing
    video.play().catch(() => {});
    
    // Remove after animation
    setTimeout(() => video.remove(), duration * 1000 + 100);
  }

  // Start spawning flying videos
  function startFlyingVideos() {
    // Spawn initial batch
    for (let i = 0; i < 3; i++) {
      setTimeout(() => createFlyingVideo(), i * 500);
    }
    
    // Continue spawning
    flyingInterval = window.setInterval(() => {
      createFlyingVideo();
    }, 1500);
  }

  // Stop flying videos
  function stopFlyingVideos() {
    if (flyingInterval) {
      clearInterval(flyingInterval);
      flyingInterval = null;
    }
  }

  // Start video and audio on page load
  document.addEventListener('DOMContentLoaded', () => {
    // Start flying videos
    startFlyingVideos();
    
    // Start audio
    if (transitionAudio) {
      transitionAudio.play().catch(err => {
        console.log('Audio autoplay blocked:', err);
        // If autoplay is blocked, try to play on first click
        document.addEventListener('click', () => {
          transitionAudio.play().catch(() => {});
        }, { once: true });
      });
    }
  });

  // Replay button - restart audio from beginning
  replayBtn?.addEventListener('click', () => {
    if (transitionAudio) {
      transitionAudio.currentTime = 0;
      transitionAudio.play().catch(err => console.log('Audio play failed:', err));
    }
  });

  // Accept button - go to landing page
  acceptBtn?.addEventListener('click', () => {
    // Stop audio if playing
    if (transitionAudio) {
      transitionAudio.pause();
    }
    // Stop flying videos
    stopFlyingVideos();
    // Navigate to landing page
    window.location.href = '/landing';
  });
</script>
